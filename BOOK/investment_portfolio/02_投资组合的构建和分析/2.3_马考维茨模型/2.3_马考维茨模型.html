
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <title>2.3 马考维茨模型</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=STIX+Two+Math&display=swap">
  <link rel="stylesheet" href="../../markdown.css">
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="../../markdown.js"></script>
</head>
<body>
  <div class="container">
    <h1>2.3_马考维茨模型</h1>
<pre><code>
Lecture: 02_投资组合的构建和分析/2.3_马考维茨模型
Content: 2.3_马考维茨模型

</code></pre>
<h3>2.3 马考维茨模型</h3>
<p>https://wiki.mbalib.com/wiki/%E9%A9%AC%E7%A7%91%E7%BB%B4%E8%8C%A8%E7%9A%84%E5%9D%87%E5%80%BC%E4%B8%80%E6%96%B9%E5%B7%AE%E7%BB%84%E5%90%88%E6%A8%A1%E5%9E%8B</p>
<p>马考维茨模型是现代投资组合理论的基础，由哈里·马考维茨（Harry Markowitz）在1952年提出。该模型通过均值-方差分析为投资者提供了一个优化投资组合的方法，即在给定的风险水平下实现最高的预期回报。以下是对马考维茨模型的极其详细的分析。</p>
<h2>基本假设</h2>
<p>马考维茨模型的基本假设包括：</p>
<ol>
<li><strong>投资者是风险回避的</strong>：这意味着在具有相同预期回报的情况下，投资者会选择风险较小的投资组合。</li>
<li><strong>投资者根据预期回报和风险（方差）来评估投资组合</strong>：投资者会选择能够提供最高预期效用的投资组合，而不仅仅是最高预期回报的组合。</li>
<li><strong>投资者的决策基于单期模型</strong>：即投资者只关心单个投资期内的回报和风险。</li>
</ol>
<p>这些假设为模型提供了理论基础，使得投资组合的优化成为可能 。</p>
<h2>核心概念</h2>
<h3>有效前沿（Efficient Frontier）</h3>
<p>有效前沿是指在给定风险水平下具有最高预期回报的投资组合集合。通过计算每个投资组合的预期回报和风险（标准差），可以绘制出一个有效前沿。任何位于有效前沿上的投资组合都被认为是最优的，因为它们在相同的风险水平下提供了最高的回报 。</p>
<h3>风险与回报</h3>
<p>在马考维茨模型中，风险通常用投资组合回报率的方差或标准差来衡量。回报率则是投资组合中各个资产回报率的加权平均。投资者需要在风险和回报之间进行权衡，选择适合自己风险承受能力的投资组合 。</p>
<h3>相关系数和协方差</h3>
<p>相关系数和协方差用于衡量不同资产之间的关系。在构建投资组合时，资产之间的相关性是多样化风险的关键因素。负相关的资产可以显著降低投资组合的整体风险 。</p>
<h2>模型步骤</h2>
<h3>1. 数据收集</h3>
<p>收集每个资产的历史回报率数据，以及各资产之间的协方差。对于N个资产，需计算N个回报率、N个方差以及N(N-1)/2个协方差。</p>
<h3>2. 计算期望回报和风险</h3>
<p>计算每个可能投资组合的预期回报和风险。预期回报是各资产预期回报的加权平均，权重为各资产在投资组合中的比例。风险则通过投资组合的方差公式计算：</p>
<p>$$ \sigma_p^2 = \sum_{i=1}^{N}\sum_{j=1}^{N} w_i w_j \sigma_{ij} $$</p>
<p>其中，$ w_i $ 和 $ w_j $ 分别是资产i和资产j的权重，$ \sigma_{ij} $ 是资产i和资产j之间的协方差 。</p>
<h3>3. 构建有效前沿</h3>
<p>通过改变资产权重，构建一系列投资组合，绘制出有效前沿。有效前沿上的每个点都代表一个最优投资组合，这些组合在同等风险下提供了最高的预期回报 。</p>
<h3>4. 选择最优投资组合</h3>
<p>根据投资者的风险承受能力，从有效前沿上选择一个最优投资组合。例如，风险回避型投资者可能会选择靠近有效前沿左侧的低风险组合，而风险偏好型投资者可能会选择靠近右侧的高风险高回报组合 。</p>
<h2>优化过程</h2>
<h3>均值-方差优化</h3>
<p>均值-方差优化是马考维茨模型的核心，通过求解优化问题来确定最优投资组合的权重：</p>
<p>$$ \min_w \frac{1}{2} w^T \Sigma w $$
$$ s.t. \ w^T \mu = \mu_p $$
$$ \sum_{i=1}^{N} w_i = 1 $$</p>
<p>其中，$ \Sigma $ 是资产的协方差矩阵，$ \mu $ 是资产的预期回报向量，$ \mu_p $ 是投资组合的目标预期回报，$ w $ 是投资组合中各资产的权重 。</p>
<h2>实际应用</h2>
<h3>案例1：多样化投资</h3>
<p>一个典型的多样化投资组合可能包括股票、债券和现金等不同类别的资产。通过计算这些资产的预期回报和风险，以及它们之间的相关性，投资者可以构建一个风险较低且回报稳定的投资组合 。</p>
<h3>案例2：机构投资</h3>
<p>大型机构投资者，如养老基金或捐赠基金，通常使用马考维茨模型来优化其资产配置。他们会收集大量的市场数据，利用均值-方差优化方法来确定最优的资产配置比例，从而实现既定的投资目标 。</p>
<h2>结论</h2>
<p>马考维茨模型通过均值-方差优化为投资者提供了一个系统性的投资组合构建方法。该模型的核心在于通过多样化投资来降低风险，同时在给定的风险水平下实现最高的预期回报。虽然模型假设较为严格，但其理论框架和分析方法在实际应用中具有重要指导意义。</p>
<p>希望以上内容能帮助你深入理解马考维茨模型及其在投资组合中的应用。</p>
<hr>
<h3>马考维茨模型中的名词及其详细解释</h3>
<table>
<thead>
<tr>
<th>名词</th>
<th>英文名称</th>
<th>详细解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>均值-方差分析</td>
<td>Mean-Variance Analysis</td>
<td>这是马考维茨模型的核心方法，通过分析投资组合的平均回报和方差（即风险）来优化投资组合。目的是在给定的风险水平下实现最高的预期回报，或在给定的回报水平下实现最低的风险。</td>
</tr>
<tr>
<td>有效前沿</td>
<td>Efficient Frontier</td>
<td>有效前沿是一条由多个最优投资组合构成的曲线。在同等风险水平下，有效前沿上的投资组合能够提供最高的预期回报；在同等回报水平下，有效前沿上的投资组合具有最低的风险。</td>
</tr>
<tr>
<td>风险</td>
<td>Risk</td>
<td>在马考维茨模型中，风险通常用投资组合回报率的方差或标准差来衡量。方差越大，表示投资组合的回报波动性越大，即风险越高。</td>
</tr>
<tr>
<td>回报率</td>
<td>Return</td>
<td>回报率是指投资在一定时期内获得的收益与最初投资额的比率。投资组合的预期回报率是各资产回报率的加权平均值。</td>
</tr>
<tr>
<td>相关系数</td>
<td>Correlation Coefficient</td>
<td>相关系数用于衡量两种资产回报率之间的线性关系。相关系数的取值范围为-1到1，正相关表示资产回报率同向变动，负相关表示资产回报率反向变动。相关系数为0表示资产回报率之间无关。</td>
</tr>
<tr>
<td>协方差</td>
<td>Covariance</td>
<td>协方差是两个资产回报率共同变动的程度，用于描述两种资产回报率之间的关系。在构建投资组合时，资产之间的协方差是多样化风险的关键因素。</td>
</tr>
<tr>
<td>夏普比率</td>
<td>Sharpe Ratio</td>
<td>夏普比率是衡量单位风险所获得的超额回报，计算公式为：(投资组合回报率 - 无风险利率) / 投资组合标准差。夏普比率越高，表示在承担相同风险的情况下，投资组合的超额回报越高。</td>
</tr>
<tr>
<td>资产配置</td>
<td>Asset Allocation</td>
<td>资产配置是根据投资者的风险承受能力和投资目标，在不同资产类别之间进行合理分配，以实现风险和回报的最佳平衡。</td>
</tr>
<tr>
<td>风险回避</td>
<td>Risk Aversion</td>
<td>风险回避是指投资者在面对具有相同预期回报的投资时，会选择风险较小的投资。马考维茨模型假设投资者是风险回避的，即在相同回报下，投资者会倾向于选择风险较低的投资组合。</td>
</tr>
<tr>
<td>无风险利率</td>
<td>Risk-Free Rate</td>
<td>无风险利率是指在没有任何风险的情况下，投资者可以获得的回报率。通常以短期政府债券的收益率作为无风险利率的近似值。</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><strong>均值-方差分析（Mean-Variance Analysis）</strong>：</p>
<ul>
<li>这是马考维茨模型的核心方法，通过分析投资组合的平均回报和方差（即风险）来优化投资组合。目的是在给定的风险水平下实现最高的预期回报，或在给定的回报水平下实现最低的风险。</li>
</ul>
</li>
<li>
<p><strong>有效前沿（Efficient Frontier）</strong>：</p>
<ul>
<li>有效前沿是一条由多个最优投资组合构成的曲线。在同等风险水平下，有效前沿上的投资组合能够提供最高的预期回报；在同等回报水平下，有效前沿上的投资组合具有最低的风险。</li>
</ul>
</li>
<li>
<p><strong>风险（Risk）</strong>：</p>
<ul>
<li>在马考维茨模型中，风险通常用投资组合回报率的方差或标准差来衡量。方差越大，表示投资组合的回报波动性越大，即风险越高。</li>
</ul>
</li>
<li>
<p><strong>回报率（Return）</strong>：</p>
<ul>
<li>回报率是指投资在一定时期内获得的收益与最初投资额的比率。投资组合的预期回报率是各资产回报率的加权平均值。</li>
</ul>
</li>
<li>
<p><strong>相关系数（Correlation Coefficient）</strong>：</p>
<ul>
<li>相关系数用于衡量两种资产回报率之间的线性关系。相关系数的取值范围为-1到1，正相关表示资产回报率同向变动，负相关表示资产回报率反向变动。相关系数为0表示资产回报率之间无关。</li>
</ul>
</li>
<li>
<p><strong>协方差（Covariance）</strong>：</p>
<ul>
<li>协方差是两个资产回报率共同变动的程度，用于描述两种资产回报率之间的关系。在构建投资组合时，资产之间的协方差是多样化风险的关键因素。</li>
</ul>
</li>
<li>
<p><strong>夏普比率（Sharpe Ratio）</strong>：</p>
<ul>
<li>夏普比率是衡量单位风险所获得的超额回报，计算公式为：(投资组合回报率 - 无风险利率) / 投资组合标准差。夏普比率越高，表示在承担相同风险的情况下，投资组合的超额回报越高。</li>
</ul>
</li>
<li>
<p><strong>资产配置（Asset Allocation）</strong>：</p>
<ul>
<li>资产配置是根据投资者的风险承受能力和投资目标，在不同资产类别之间进行合理分配，以实现风险和回报的最佳平衡。</li>
</ul>
</li>
<li>
<p><strong>风险回避（Risk Aversion）</strong>：</p>
<ul>
<li>风险回避是指投资者在面对具有相同预期回报的投资时，会选择风险较小的投资。马考维茨模型假设投资者是风险回避的，即在相同回报下，投资者会倾向于选择风险较低的投资组合。</li>
</ul>
</li>
<li>
<p><strong>无风险利率（Risk-Free Rate）</strong>：</p>
<ul>
<li>无风险利率是指在没有任何风险的情况下，投资者可以获得的回报率。通常以短期政府债券的收益率作为无风险利率的近似值。</li>
</ul>
</li>
</ol>
<h3>详细解释</h3>
<h4>均值-方差分析</h4>
<p>均值-方差分析是通过计算各个资产的预期回报和风险（标准差），并分析不同资产组合的风险和回报之间的关系来实现的。其目的是找到最优的资产配置，使得在给定的风险水平下实现最高的预期回报，或在给定的回报水平下实现最低的风险。</p>
<h4>有效前沿</h4>
<p>有效前沿上的每个点都代表一个最优投资组合，这些组合在相同的风险水平下提供了最高的回报，或在相同的回报水平下具有最低的风险。有效前沿通常是一个向上的抛物线形状，展示了风险和回报的权衡关系。</p>
<h4>风险</h4>
<p>风险在马考维茨模型中通过投资组合回报率的标准差来衡量。标准差越大，表示回报率的波动性越大，即投资组合的风险越高。投资者需要在风险和回报之间进行权衡，选择适合自己风险承受能力的投资组合。</p>
<h4>回报率</h4>
<p>回报率是指投资在一定时期内获得的收益与最初投资额的比率。在投资组合中，各个资产的预期回报率通过加权平均计算得出，权重为各资产在投资组合中的比例。</p>
<h4>相关系数和协方差</h4>
<p>相关系数和协方差用于描述不同资产之间的关系。负相关的资产可以显著降低投资组合的整体风险，因为当一种资产的回报下降时，另一种资产的回报可能会上升，从而平滑整体回报的波动。</p>
<h4>夏普比率</h4>
<p>夏普比率用于衡量单位风险所获得的超额回报，是选择最优投资组合的重要指标。夏普比率越高，表示在承担相同风险的情况下，投资组合的超额回报越高。</p>
<h4>资产配置</h4>
<p>资产配置是指在不同的资产类别之间分配资金，以实现投资组合的多样化和风险管理。通过合理的资产配置，投资者可以在不同市场环境中保持投资组合的稳定性和回报率。</p>
<h4>风险回避</h4>
<p>风险回避是马考维茨模型的基本假设之一，指投资者在面对具有相同预期回报的投资时，会选择风险较小的投资。模型假设投资者会根据预期回报和风险来评估投资组合，并选择能够提供最高预期效用的组合。</p>
<h4>无风险利率</h4>
<p>无风险利率是指在没有任何风险的情况下，投资者可以获得的回报率。通常以短期政府债券的收益率作为无风险利率的近似值，在计算夏普比率时使用。</p>
<p>以上是马考维茨模型中涉及的主要名词及其详细解释。希望这些解释能够帮助你更好地理解马考维茨模型及其在投资组合优化中的应用。</p>

    <h3>Python 文件</h3>
    <pre><code>import numpy as np
import pandas as pd
from typing import List, Tuple
from scipy.optimize import minimize

class MarkowitzModel:
    """
    马考维茨模型类，用于优化投资组合

    Attributes:
        returns (pd.DataFrame): 各资产的历史回报率数据
        covariance_matrix (np.ndarray): 资产之间的协方差矩阵
        mean_returns (np.ndarray): 各资产的平均回报率
    """

    def __init__(self, returns: pd.DataFrame):
        """
        初始化马考维茨模型

        Args:
            returns (pd.DataFrame): 各资产的历史回报率数据
        """
        self.returns = returns
        self.covariance_matrix = returns.cov()
        self.mean_returns = returns.mean()

    def calculate_portfolio_performance(self, weights: np.ndarray) -> Tuple[float, float]:
        """
        计算投资组合的预期回报和风险（标准差）

        Args:
            weights (np.ndarray): 投资组合中各资产的权重

        Returns:
            Tuple[float, float]: 投资组合的预期回报和风险（标准差）
        """
        portfolio_return = np.dot(weights, self.mean_returns)
        portfolio_std_dev = np.sqrt(np.dot(weights.T, np.dot(self.covariance_matrix, weights)))
        return portfolio_return, portfolio_std_dev

    def generate_random_portfolios(self, num_portfolios: int) -> pd.DataFrame:
        """
        生成随机投资组合，计算其预期回报和风险

        Args:
            num_portfolios (int): 要生成的随机投资组合数量

        Returns:
            pd.DataFrame: 包含随机投资组合的预期回报、风险和权重的数据框
        """
        results = np.zeros((num_portfolios, 3 + len(self.returns.columns)))

        for i in range(num_portfolios):
            weights = np.random.random(len(self.returns.columns))
            weights /= np.sum(weights)
            portfolio_return, portfolio_std_dev = self.calculate_portfolio_performance(weights)
            results[i, 0] = portfolio_return
            results[i, 1] = portfolio_std_dev
            results[i, 2] = portfolio_return / portfolio_std_dev  # 夏普比率
            results[i, 3:] = weights

        columns = ['Return', 'Risk', 'Sharpe Ratio'] + [f'Weight {symbol}' for symbol in self.returns.columns]
        return pd.DataFrame(results, columns=columns)

    def optimize_portfolio(self, risk_free_rate: float = 0.0) -> Tuple[np.ndarray, float, float]:
        """
        使用夏普比率优化投资组合

        Args:
            risk_free_rate (float): 无风险利率，默认为0

        Returns:
            Tuple[np.ndarray, float, float]: 最优投资组合的权重、预期回报和风险（标准差）
        """
        num_assets = len(self.returns.columns)
        args = (self.mean_returns, self.covariance_matrix, risk_free_rate)
        constraints = ({'type': 'eq', 'fun': lambda x: np.sum(x) - 1})
        bounds = tuple((0, 1) for asset in range(num_assets))

        result = minimize(self.neg_sharpe_ratio, num_assets * [1. / num_assets,], args=args,
                          method='SLSQP', bounds=bounds, constraints=constraints)

        return result.x, *self.calculate_portfolio_performance(result.x)

    def neg_sharpe_ratio(self, weights: np.ndarray, mean_returns: np.ndarray, covariance_matrix: np.ndarray, risk_free_rate: float) -> float:
        """
        计算负的夏普比率（用于优化）

        Args:
            weights (np.ndarray): 投资组合中各资产的权重
            mean_returns (np.ndarray): 各资产的平均回报率
            covariance_matrix (np.ndarray): 资产之间的协方差矩阵
            risk_free_rate (float): 无风险利率

        Returns:
            float: 负的夏普比率
        """
        p_ret, p_var = self.calculate_portfolio_performance(weights)
        return -(p_ret - risk_free_rate) / p_var

# 示例用法
if __name__ == "__main__":
    # 生成示例数据
    symbols = ['AAPL', 'MSFT', 'GOOGL']
    data = {
        'AAPL': np.random.normal(0.001, 0.01, 1000),
        'MSFT': np.random.normal(0.001, 0.01, 1000),
        'GOOGL': np.random.normal(0.001, 0.01, 1000),
    }
    returns = pd.DataFrame(data)
    
    # 初始化马考维茨模型
    model = MarkowitzModel(returns)
    
    # 生成随机投资组合并输出
    portfolios = model.generate_random_portfolios(5000)
    print(portfolios.head())
    
    # 优化投资组合并输出
    optimal_weights, expected_return, expected_risk = model.optimize_portfolio()
    print("Optimal Weights:", optimal_weights)
    print("Expected Return:", expected_return)
    print("Expected Risk:", expected_risk)</code></pre>
  </div>
</body>
</html>
  